\section{Adversary Model}
%%In this section, we explore the attacks that can be carried out by the adversary. We explain our infrastructure which we used to carry out attack on our victim. Finally, we present the taxonomy of attacks with discussion on their viability, stealthiness and  implications for the domain owners.

%MK: In this section, we present the taxonomy of attacks by our adversary using DNS dynamic updates on vulnerable slave server. 
In this section, we present the taxonomy of attacks by an adversary on a vulnerable authoritative name server.
We refer to the attacks exploiting non-secure DNS dynamic updates as to \textit{zone poisoning}.
%
We first explain our setup to perform lab experiments, followed by 
presenting the attack vectors. 
%the methodology which we used to %compromise domain validation to obtain a valid digital certificate for a vulnerable domain.
%confirm different attack vectors.
%Finally, w
We discuss the viability and stealthiness of these attacks and %MK: also explain the implications for the domain owners. 
the implications for owners of vulnerable domains.

%using zone poisoning vulnerability. We discuss the viability and stealthiness of these attacks and also explain the implications for the domain owners.

\subsection{Infrastructure Setup}

In order to explain the adversary model and test it in an isolated environment, we set up our infrastructure %comprising of 
composed of two servers. 
%MK: A DNS server that is vulnerable to receive  dynamic zone updates (victim) without authentication from any authoritative server. The second server will act as an adversary to update the zone files of our victim.  We explain these configurations in detail below. 


\textbf{Adversary configuration:} Depending on the type of attack, different configurations might be required. 
In our setup, we assume that our adversary has already scanned for vulnerable 
resources and knows the domain name and its authoritative name server.
%MK: servers and knows the public IP address of the victim. 
The adversary will also require the standard dynamic DNS update utility \texttt{nsupdate}\footnote{%Dynamic DNS update utility:
\url{https://linux.die.net/man/8/nsupdate}} (or another dedicated software) to modify the zone of the victim. %Furthermore, f
For more advanced attacks the adversary might need to set up a mail, a web or a DNS server.
%Depending on the type of attack, different configurations might be required. In our setup, we assume our adversary has already scanned for vulnerable servers and knows the public IP address of our victim. 

%\hl{has access to the compromised machine} \michal{It's a bit confusing to me. Does it mean, that the adversary has like ssh access? Or just that there's connectivity between both hosts? Also the Victim is not yet compromised during the setup, right?} with a public IP address. The adversary will also require Dynamic DNS update utility \texttt{nsupdate} to modify the zone of our victim. Furthermore, for more sophisticated attacks other services like email server and webserver are required. %An email server with forwarding is also required for more sophisticated attacks explained later. EDIT

\textbf{Victim configuration:} Our victim server is running BIND 9.8.4 DNS and Apache HTTP software. 
%MK: For the adversary to modify DNS records, t
The victim server is configured to allow non-secure dynamic updates %of records as explained in the previous section. 
from anyone using the built-in argument ``any'' in the zone configuration of our domain (\url{example.com}), as explained in the previous section.
%
%We assume that o
Our victim is hosting a website, 
which is protected with an SSL certificate. 
The victim server might also have a mail server configured with the corresponding \texttt{MX} record defined in the zone file.  


\subsection{Taxonomy of Attacks}
We define the attacks by the adversary in the following three categories and present the tradeoff between viability and stealthiness of each attack:

%We present the details of the following three types of attacks by the adversary and discuss the viability and stealthiness of these attacks. We also analyze the implications of these attacks on our victim

\begin{itemize}
\item \textbf{Denial of Service (DoS) attack:} In the DoS attack the adversary will be able to disrupt a service (e.g.: web, mail, domain, ssh, etc.) of the victim temporarily. 
It is much easier to execute with limited stealthiness, as the victim would notice the unresponsive domain and would be able to fix the configuration quickly. 


\item \textbf{Man-in-the-Middle (MITM) attack:} MITM attack requires more sophistication from the adversary while being more stealthy and difficult to detect. In this type of the attack, our adversary will %comprise 
poison the victim's zone file and redirect traffic to its server and then back to the victim without getting detected. It can be used to capture the traffic between the victim's server and its clients. %customers.  

\item \textbf{Domain shadowing attack:} %Finally, t
The adversary might also be able to spawn malicious subdomains which she can then use for exploit kits, malware, phishing and stealing information from the victim. 
Domain shadowing attacks~\cite{shadowing} are more stealthy in nature as the subdomains inherit the trust of the parent domain which enables them to evade countermeasures based on domain reputation or blacklisting systems. The attacker can spawn multiple subdomains at no cost and can rotate between them to evade detection. 

The domain shadowing attack can be further sophisticated by by-passing domain control validation in order to setup a valid SSL certificate for a malicious subdomain.
In Section~\ref{sec:domainvalidation} we explain the details of this attack vector.

%Furthermore in Section~\ref{sec:domainvalidation} we explain how attackers can by-pass domain control validation in order to setup SSL certificates. 
\end{itemize}



\subsubsection{Denial of Service (DoS) Attack} 
The DoS attack will only cause limited disruption in the service until the victim gets notified. However, these types of attacks can result in financial losses due to domain downtime or loss of customers. The adversary can cause a DoS attack using one of the following methods: %methodologies. 

\textbf{Deletion of an \texttt{A}/\texttt{AAAA} record of domain or subdomain:} The adversary can remove an \texttt{A} or \texttt{AAAA} record which will delete the mapping between the domain and the corresponding IPv4 or IPv6 address of \url{example.com} from the zone file. 
%MK: It will result in downtime of the traffic. 
Note that adversary can also delete a subdomain %with the same command.
with \texttt{nusupdate} utility command ``\texttt{update delete example.com A}''. 
%corresponding to the web, ftp, or mail service. 
If the victim is running different services like accounts, mail, ftp, or checkout on a separate subdomain, it will partially disable a part of the website and might take more time to~detect. 
%with \texttt{nusupdate} utility command \texttt{update delete example.com A} using nsupdate. 

\textbf{Deletion of MX records:} Similarly, the adversary can also delete an \texttt{MX} (mail exchange) record which specifies the name of the mail server responsible for accepting email messages on behalf of a domain name.
It will not only disrupt an email service but also hinder any abuse messages sent to the victim. 
% Deletion of NS records not possible 
%\textbf{Deletion of NS record:} Deletion of NS record will be most disruptive for the victim as all available domains including email service will be un-accessible to victim and its users till the zone file is updated with correct records. 
 % Need to check following statements...
% Check edit of SOA records .... 


 \textbf{Deletion of zone delegation:} Delegated zones can be used for variety of purposes. It can be used for management of domains and subdomains or for the backup if master zone is down,  when configured as slave. If the adversary successfully deletes delegation in the zone file. It would not only cause service disruption to the  domains handled by delegated server, but would also disrupt a backup. 


\subsubsection{Man-in-the-middle (MITM) Attacks}
The second type of attack that adversary can utilize is MITM attack. These attacks can be more sophisticated and harder to detect. 

\textbf{Update of A records:}
Adversary can update the A records in the zone file of the victim and change IP address to its compromised machine. In this way the traffic directed towards the victim will be redirected towards the adversary. If the adversary acts as a proxy server it can gain useful information about the victims. For instance, the number of customers, geo-location based on IP addresses and pages that were visited by the customers. However, for a more sophisticated attack the adversary can setup a phishing website to steal all the personal information from the customers of the victim. He can then forward the collected information back to the customer for an increase stealthiness. 

\textbf{Update of MX records:} 
If the victim runs a mail server, adversary can also change the MX record with its own IP. The adversary in this case can store the emails of the victims and forward the emails back to the victim. If the adversary wants to run a phishing website it can also update the MX record and bypass email challenge to validate the domain. 

%and map its own IP address for the domain. In this case the traffic for his server will be redirected towards to the adversaries server. However, the victim or its customers would be able to detect the outage. If the adversary run a phishing website similar to the victim, he might be able to successfully steal customer information. Similarly, adversary will also be able to build a completely new sub-domain of our victim legitimate domain. He can then use the sub-domain to collect 




%\begin{itemize}
%\item redirect traffic for disruption
%\item add a subdomain and redirect info after stealing 
%\item add a subdomain to launch a phising attack 
%\item add a domain with domain verfication using certs to show as legitimate site 
%\end{itemize}
%\textbf{Add/Update MX record:} 
%\begin{itemize}
%\item redirect all mail to own servers to steal important information 
%\item add another mx record with subdomain to use in phishing scam 
%\item add an mx record with email server configured to by pass domain verification required for SSL certificates
%\end{itemize}


\subsubsection{Domain Shadowing Attack}

Finally, the adversary can spawn the subdomains for phishing and exploit kit attacks by adding A and AAAA records to the zone files. Furthermore, the attacker can add MX record which can be useful in redirecting abuse emails to the attacker and increase the stealthiness of the attack. 

\textbf{Add A record:} 
Adversary can add an A records for subdoamins with IP address pointing to the server under its control in the victims zone file. He can spawn unlimited number of subdomains and rotate between them to evade detection. Adversary can use the business model of the parent domain and can setup subdomains for phishing attack. The victim would not be able to detect attack unless it is notified. Furthermore, the attacker can use the reputation of the victim's domain to by-pass blacklisting services for the exploit kit attack. It can also lead to adversely impact the reputation of the victim's domain and business after the attack is discovered by various blacklisting services.

\textbf{Add Domain Delegation:}
In order to spawn multiple subdomains and rotations between them the adversary needs to constantly update the zone file of victim. It might alert the victim because to constant changes in the file. In order to improve the stealthiness of this attack adversary can add delegated domain. It can then spawn multiple subdomains on his server without any updates to victim zone file. For example if the adversary add a delegated domain
\textit{accounts.example.com} with the command %check this 
\textit{nsupdate NS 10.10.10.10 accounts.example.com}. He can then spawn cs.accounts.example.com or any other sibling domains in the zone file of 10.10.10.10 server without any interaction with the victim server. 




\subsubsection{Compromising Domain Control Validation\label{sec:domainvalidation}}

% Why domain control validation is important .. motivation 
% WHich certs did we chose and why 
% Our methodology to bypass DCV 
% What does it add attack vectors 

In order to establish the authenticity of the domain and have an encrypted communication between the browser of the user and a website, a digital certificate is used. It offers confidentiality to the user as all the data is encrypted using the SSL/TLS certificate offered by the website owner. The user before sending the encrypted traffic to the website establishes the integrity of the certificate from a  Certificate Authority (CA). 

To acquire a digitally signed certificate from a reputed CA  the domain owner must establish its legitimacy. The process through which a  domain owner validates its ownership rights is known as Domain Control Validation (DCV). 

The three most common methods to establish the ownership are as follows. 
a) \textbf {Email validation} is one of the most well-known options to confirm domain ownership. During the certificate activation process, the domain owner selects one of the email addresses from either email address in whois records or domain-related emails. The domain related email addresses have generics in front of domains for instance for example.com  the valid addresses could be admin@example.com, administrator@example.com, postmaster@example.com, webmaster@example.com or hostmaster@example.com. Once the email address is selected the validation link is then sent to the requested email address for confirmation. b) \textbf{HTTP-based validation} requires to download a file from the CA and place it in the directory mentioned by the CA. The file must be accessible using HTTP request. For instance, in the case of example.com domain, the following URL should be accessible http://example.com/.well-known/pki-validation/filename.txt. This will enable CA to validate ownership of the domain owner. c) \textbf{DNS-based validation} requires you to create a certain CNAME record in the DNS settings of your domain. The CNAME contains a random string generated by the CA. If the URL is accessible by the CA validates the domain ownership. 


In our experimental setup we were able to by-pass domain control validation and were able to obtain certificates from two top Certificate Authorities (Let's encrypt and Comodo). %Majority of CA requires either email listed in SOA record or setup a challenge on the domain. Using our methodology the adversary can bypass both of the methods to obtain a legitimate certificate for the domain. 

\textbf{ Add MX record:} 
Adversary can also add mx record to victims zone file. It can be useful for particular places, a ) compromise email based challenge for domain control validation. %Adversary can also edit SOA records to get the abuse emails further avoid detection.


